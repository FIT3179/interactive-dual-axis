<!DOCTYPE html>
<html>
<head>
  <title>Dual Axis Line Chart with Vertical Sliders</title>
  <style>
   .slider {
      height: 20px; /* Set the height to fit the slider properly */
      transform: rotate(-90deg);
      transform-origin: right; /* Set the transform origin to the right side */
    }
    body{
        font-family: 'Roboto', sans-serif;
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;400;500&display=swap" rel="stylesheet">
  <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
  <div id="chart-container"></div>
  <h1>Dual-axis line chart with interactive y-axes</h1>
  <p>Click and drag the sliders to adjust the scale of the axes. The data is synthesized. </p>
  <small>Made with d3.js. By Kadek Satriadi, with the help of ChatGPT. Version 1.0 (August 2, 2023).</small>
  <script>
  class DualAxis {
    constructor(data, id){
      this.data = data;
      this.id = id;
      this.container = document.getElementById(this.id);
      this.svg;
      this.init();
    }

    init = function(){
        // Set up the dimensions of the chart
        const margin = { top: 30, right: 50, bottom: 30, left: 50 };
        //Range values
        const range ={
            min: 0, 
            max: 400
        };

        var rawwidth = 900;
        var y1offset = -10;
        var y2offset = 0;
        const width = rawwidth - margin.left - margin.right;
        const height = range.max - margin.top - margin.bottom;

        //Change the lenght of the sliders
        var slider1 = document.createElement('input');
        var slider2 = document.createElement('input');
        var offsetinput1 = document.createElement('input');
        var offsetinput2 = document.createElement('input');

        slider1.type = "range";
        slider2.type = "range";
        slider1.classList.add('slider');
        slider2.classList.add('slider');

        offsetinput1.type = "number";
        offsetinput2.type = "number";
        offsetinput1.style.position = 'absolute';
        offsetinput2.style.position = 'absolute';

        slider1.max = range.max * 2;
        slider2.max = range.max * 2;
        slider1.value = range.max;
        slider2.value = range.max;
        slider1.style.width = height + 'px';
        slider2.style.width = height + 'px';
        slider1.style.position = 'absolute';
        slider2.style.position = 'absolute';
        slider1.style.left = (-rawwidth * 0.5 + margin.left + margin.right + 20) + 'px';
        slider1.style.top = (margin.top) + 'px';
        slider2.style.left = ((rawwidth * 0.5) + margin.right + margin.left) + 'px';
        slider2.style.top = (margin.top) + 'px';

        this.container.append(offsetinput1);
        this.container.append(offsetinput2);
        this.container.append(slider1);
        this.container.append(slider2);



        // Create SVG container
       
        this.svg = d3.select(this.container)
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", `translate(${margin.left}, ${margin.top})`);

        // Parse the date and convert strings to dates
        const parseDate = d3.timeParse("%Y-%m-%d");
        data.forEach(d => d.date = parseDate(d.date));

        // Define scales for x and y axes
        const xScale = d3.scaleTime()
          .domain(d3.extent(data, d => d.date))
          .range([0, width]);

        const yScale1 = d3.scaleLinear()
          .domain([0, d3.max(data, d => d.value1)])
          .range([height, range.min]);

        const yScale2 = d3.scaleLinear()
          .domain([0, d3.max(data, d => d.value2)])
          .range([height, range.min]);

        // Define the line functions for both lines
        const line1 = d3.line()
          .x(d => xScale(d.date))
          .y(d => yScale1(d.value1));

        const line2 = d3.line()
          .x(d => xScale(d.date))
          .y(d => yScale2(d.value2));

        // Draw the first line
        this.svg.append("path")
          .datum(data)
          .attr("class", "line line1") // Add the class for line1
          .attr("d", line1)
          .attr("fill", "none")
          .attr("stroke", "steelblue")
          .attr("stroke-width", 2);

        // Draw the second line
        this.svg.append("path")
          .datum(data)
          .attr("class", "line line2") // Add the class for line2
          .attr("d", line2)
          .attr("fill", "none")
          .attr("stroke", "orange")
          .attr("stroke-width", 2);

        // Create x and y axes
        const xAxis = d3.axisBottom(xScale);
        const yAxis1 = d3.axisLeft(yScale1).ticks(5);
        const yAxis2 = d3.axisRight(yScale2).ticks(5);

        // Append x and y axes to the chart
        this.svg.append("g")
          .attr("class", "x-axis") // Add class for x-axis
          .attr("transform", `translate(0, ${height})`)
          .call(xAxis);

        this.svg.append("g")
          .attr("class", "y1-axis") // Add class for y1-axis
          .call(yAxis1);

        this.svg.append("g")
          .attr("class", "y2-axis") // Add class for y2-axis
          .attr("transform", `translate(${width}, 0)`)
          .call(yAxis2);

        
        // Interactive sliders
       this.initSliderUpdate(slider1, yScale1, yAxis1, line1, d3.max(data, d => d.value1), "y1-axis", "line1");
       this.initSliderUpdate(slider2, yScale2, yAxis2, line2, d3.max(data, d => d.value2),  "y2-axis", "line2");

    }

    initSliderUpdate = function(slider, yScale, yAxis, line, max, y, l){
      var t = this;
      slider.oninput = function () {
          const value =  0.5 * slider.max / slider.value;
          t.updateChart(value, max, y, l, yAxis, yScale, line);
        };
    }

    updateChart = function(value, max, y, l, yAxis, yScale, line){
          const yDomain = [0, max * value];
          yScale.domain(yDomain);
          this.svg.select("."+y).call(yAxis);
          this.svg.selectAll("."+l).attr("d", line);
    }

  }
  </script>
  <script>
       // Sample data for demonstration purposes
       const data = [
     { date: "2023-08-01", value1: 50, value2: 200 },
    { date: "2023-08-02", value1: 75, value2: 180 },
    { date: "2023-08-03", value1: 100, value2: 160 },
    { date: "2023-08-04", value1: 120, value2: 170 },
    { date: "2023-08-05", value1: 140, value2: 190 },
    { date: "2023-08-06", value1: 160, value2: 220 },
    { date: "2023-08-07", value1: 180, value2: 230 },
    { date: "2023-08-08", value1: 200, value2: 250 },
    { date: "2023-08-09", value1: 220, value2: 240 },
    { date: "2023-08-10", value1: 240, value2: 230 },
    // Additional data points
    { date: "2023-08-11", value1: 260, value2: 220 },
    { date: "2023-08-12", value1: 280, value2: 200 },
    { date: "2023-08-13", value1: 300, value2: 180 },
    { date: "2023-08-14", value1: 320, value2: 170 },
    { date: "2023-08-15", value1: 340, value2: 190 },
    { date: "2023-08-16", value1: 360, value2: 220 },
    { date: "2023-08-17", value1: 380, value2: 230 },
    { date: "2023-08-18", value1: 400, value2: 250 },
    { date: "2023-08-19", value1: 420, value2: 240 },
    { date: "2023-08-20", value1: 440, value2: 230 },
    // Add more data points here
    ];

  var chart1 = new DualAxis(data, "chart-container");

  </script>
</body>
</html>
